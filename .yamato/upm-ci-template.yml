editors:
  - version: 2019.3
  - version: fast-2019.3
packages:
  - name: HDRP
    id: hdrp
    packagename: com.unity.template-hd
    dependencies:
      - .yamato/upm-ci-template.yml#pack_hdrp
  - name: Universal
    id: universal
    packagename: com.unity.render-pipelines.universal
    dependencies:
      - .yamato/upm-ci-template.yml#pack_universal
platforms:
    - name: win
      os: windows
      components:
      - editor
      - il2cpp
      agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
      copycmd: copy upm-ci~\packages\*.tgz .Editor\Data\Resources\PackageManager\ProjectTemplates
      editorpath: .\.Editor
    - name: mac
      os: macos
      components:
      - editor
      - il2cpp
      agent:
        type: Unity::VM::osx
        image: buildfarm/mac:stable
        flavor: m1.mac
      copycmd: cp ./upm-ci~/packages/*.tgz ./.Editor/Unity.app/Contents/Resources/PackageManager/ProjectTemplates
      editorpath: "$(pwd)/.Editor/Unity.app/Contents/MacOS/Unity"
---
{% for package in packages %}
pack_{{ package.id }}:
  name: Pack {{ package.name }}
  agent:
    type: Unity::VM
    image: package-ci/win10:stable
    flavor: b1.large
  commands:
    - npm install upm-ci-utils@stable -g --registry https://api.bintray.com/npm/unity/unity-npm
    - upm-ci template pack --keep-project-settings --package-path {{ package.packagename }}
  artifacts:
    packages:
      paths:
        - "upm-ci~/packages/**/*"
{% endfor %}

